<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LOKAYA GFX — Elite Design Studio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@300;400;500;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged }
      from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy, serverTimestamp }
      from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBBsP0-ODrStB6QOdlzQVpcR-k20mhhSZY",
      authDomain: "lokayafx-ef19a.firebaseapp.com",
      projectId: "lokayafx-ef19a",
      storageBucket: "lokayafx-ef19a.firebasestorage.app",
      messagingSenderId: "546398827272",
      appId: "1:546398827272:web:ea0848652769622591b2bd"
    };

    const ADMIN_EMAIL = "itzlokaya@gmail.com";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    let currentUser = null;
    let portfolioItems = [];
    let statusItems = [];

    // ─── AUTH ───────────────────────────────────────────────────────────────
    window.loginWithGoogle = async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        if (result.user.email !== ADMIN_EMAIL) {
          await signOut(auth);
          showToast("Access denied. Admin only.", "error");
        }
      } catch (e) {
        showToast("Login failed: " + e.message, "error");
      }
    };

    window.logoutUser = async () => {
      await signOut(auth);
      showView("public");
      showToast("Signed out successfully.", "info");
    };

    onAuthStateChanged(auth, user => {
      currentUser = user;
      if (user && user.email === ADMIN_EMAIL) {
        document.getElementById("adminBtn").classList.remove("hidden");
        document.getElementById("loginBtn").classList.add("hidden");
        document.getElementById("logoutBtn").classList.remove("hidden");
      } else {
        document.getElementById("adminBtn").classList.add("hidden");
        document.getElementById("loginBtn").classList.remove("hidden");
        document.getElementById("logoutBtn").classList.add("hidden");
        if (document.getElementById("dashboard").classList.contains("active-view")) {
          showView("public");
        }
      }
    });

    // ─── VIEWS ──────────────────────────────────────────────────────────────
    window.showView = (view) => {
      document.querySelectorAll(".view").forEach(v => v.classList.remove("active-view"));
      document.getElementById(view).classList.add("active-view");
      if (view === "dashboard") {
        loadDashboardPortfolio();
        loadDashboardStatus();
        document.getElementById("dashSection").classList.add("active-dash");
        document.getElementById("statusSection").classList.remove("active-dash");
      }
      if (view === "public") {
        loadPublicPortfolio();
        loadPublicStatus();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    };

    window.showDash = (sec) => {
      document.querySelectorAll(".dash-section").forEach(s => s.classList.remove("active-dash"));
      document.getElementById(sec + "Section").classList.add("active-dash");
      document.querySelectorAll(".dash-tab").forEach(t => t.classList.remove("tab-active"));
      document.getElementById("tab-" + sec).classList.add("tab-active");
    };

    // ─── PORTFOLIO ───────────────────────────────────────────────────────────
    async function fetchPortfolio() {
      const q = query(collection(db, "portfolio"), orderBy("createdAt", "desc"));
      const snap = await getDocs(q);
      portfolioItems = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      return portfolioItems;
    }

    async function loadPublicPortfolio() {
      const grid = document.getElementById("portfolioGrid");
      grid.innerHTML = `<div class="col-span-full flex justify-center py-16"><div class="spinner"></div></div>`;
      const items = await fetchPortfolio();
      if (!items.length) {
        grid.innerHTML = `<div class="col-span-full text-center py-16 text-gray-600 font-poppins">No portfolio items yet.</div>`;
        return;
      }
      grid.innerHTML = items.map(item => `
        <div class="glass-card rounded-2xl overflow-hidden group cursor-pointer" onclick="openLightbox('${escHtml(item.imageUrl)}','${escHtml(item.title)}','${escHtml(item.desc || '')}')">
          <div class="relative overflow-hidden aspect-video bg-black/40">
            <img src="${escHtml(item.imageUrl)}" alt="${escHtml(item.title)}"
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              onerror="this.src='https://placehold.co/600x340/1a0033/bf00ff?text=GFX'"/>
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-4">
              <span class="text-white font-poppins text-xs uppercase tracking-widest">View</span>
            </div>
            ${item.category ? `<span class="absolute top-3 left-3 badge">${escHtml(item.category)}</span>` : ""}
          </div>
          <div class="p-5">
            <h3 class="font-bebas text-xl text-white tracking-wider mb-1">${escHtml(item.title)}</h3>
            <p class="font-poppins text-gray-500 text-xs leading-relaxed line-clamp-2">${escHtml(item.desc || "")}</p>
          </div>
        </div>
      `).join("");
    }

    async function loadDashboardPortfolio() {
      const list = document.getElementById("dashPortfolioList");
      list.innerHTML = `<div class="flex justify-center py-10"><div class="spinner"></div></div>`;
      const items = await fetchPortfolio();
      if (!items.length) {
        list.innerHTML = `<p class="text-center text-gray-600 py-10 font-poppins text-sm">No items yet.</p>`;
        return;
      }
      list.innerHTML = items.map(item => `
        <div class="glass-card rounded-xl flex items-center gap-4 p-4">
          <img src="${escHtml(item.imageUrl)}" class="w-16 h-12 object-cover rounded-lg flex-shrink-0 bg-black/40"
            onerror="this.src='https://placehold.co/64x48/1a0033/bf00ff?text=IMG'"/>
          <div class="flex-1 min-w-0">
            <p class="font-bebas text-white text-lg tracking-wider truncate">${escHtml(item.title)}</p>
            <p class="font-poppins text-gray-500 text-xs truncate">${item.category || "Uncategorized"}</p>
          </div>
          <div class="flex gap-2 flex-shrink-0">
            <button onclick="editPortfolioItem('${item.id}','${escAttr(item.title)}','${escAttr(item.desc||'')}','${escAttr(item.imageUrl)}','${escAttr(item.category||'')}')"
              class="btn-icon text-blue-400 hover:text-blue-300"><i class="fa-solid fa-pen text-xs"></i></button>
            <button onclick="deletePortfolioItem('${item.id}')"
              class="btn-icon text-red-400 hover:text-red-300"><i class="fa-solid fa-trash text-xs"></i></button>
          </div>
        </div>
      `).join("");
    }

    window.savePortfolioItem = async () => {
      const editId  = document.getElementById("editPortfolioId").value;
      const title   = document.getElementById("pTitle").value.trim();
      const desc    = document.getElementById("pDesc").value.trim();
      const imgUrl  = document.getElementById("pImg").value.trim();
      const cat     = document.getElementById("pCat").value.trim();

      if (!title || !imgUrl) { showToast("Title and Image URL are required.", "error"); return; }

      setBtnLoading("savePortfolioBtn", true);
      try {
        if (editId) {
          await updateDoc(doc(db, "portfolio", editId), { title, desc, imageUrl: imgUrl, category: cat });
          showToast("Item updated!", "success");
        } else {
          await addDoc(collection(db, "portfolio"), { title, desc, imageUrl: imgUrl, category: cat, createdAt: serverTimestamp() });
          showToast("Item added!", "success");
        }
        clearPortfolioForm();
        loadDashboardPortfolio();
        loadPublicPortfolio();
      } catch (e) {
        showToast("Error: " + e.message, "error");
      }
      setBtnLoading("savePortfolioBtn", false);
    };

    window.editPortfolioItem = (id, title, desc, img, cat) => {
      document.getElementById("editPortfolioId").value = id;
      document.getElementById("pTitle").value = title;
      document.getElementById("pDesc").value = desc;
      document.getElementById("pImg").value = img;
      document.getElementById("pCat").value = cat;
      document.getElementById("savePortfolioBtn").innerHTML = '<i class="fa-solid fa-floppy-disk mr-2"></i>Update Item';
      document.getElementById("cancelEditPortfolio").classList.remove("hidden");
      document.getElementById("portfolioForm").scrollIntoView({ behavior: "smooth" });
    };

    window.cancelPortfolioEdit = () => { clearPortfolioForm(); };

    function clearPortfolioForm() {
      document.getElementById("editPortfolioId").value = "";
      document.getElementById("pTitle").value = "";
      document.getElementById("pDesc").value = "";
      document.getElementById("pImg").value = "";
      document.getElementById("pCat").value = "";
      document.getElementById("savePortfolioBtn").innerHTML = '<i class="fa-solid fa-plus mr-2"></i>Add to Armory';
      document.getElementById("cancelEditPortfolio").classList.add("hidden");
    }

    window.deletePortfolioItem = async (id) => {
      if (!confirm("Delete this item?")) return;
      try {
        await deleteDoc(doc(db, "portfolio", id));
        showToast("Deleted.", "success");
        loadDashboardPortfolio();
        loadPublicPortfolio();
      } catch (e) { showToast("Error: " + e.message, "error"); }
    };

    // ─── STATUS TRACKER ───────────────────────────────────────────────────────
    const PROGRESS_LABELS = { 10: "Starting", 25: "In Progress", 50: "Halfway", 75: "Almost Done", 100: "Complete" };

    async function fetchStatus() {
      const q = query(collection(db, "status"), orderBy("createdAt", "desc"));
      const snap = await getDocs(q);
      statusItems = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      return statusItems;
    }

    async function loadPublicStatus() {
      const cont = document.getElementById("statusContainer");
      cont.innerHTML = `<div class="flex justify-center py-10"><div class="spinner"></div></div>`;
      const items = await fetchStatus();
      if (!items.length) {
        cont.innerHTML = `<p class="text-center text-gray-600 py-10 font-poppins text-sm">No active projects.</p>`;
        return;
      }
      cont.innerHTML = items.map(item => {
        const pct = item.progress || 10;
        const label = PROGRESS_LABELS[pct] || "In Progress";
        return `
          <div class="glass-card rounded-xl p-5">
            <div class="flex items-center justify-between mb-3">
              <div>
                <p class="font-bebas text-white text-lg tracking-wider">${escHtml(item.clientName)}</p>
                <p class="font-mono text-xs text-purple-400 mt-0.5">${escHtml(item.projectTitle || "Design Project")}</p>
              </div>
              <div class="text-right">
                <span class="font-bebas text-2xl text-purple-300">${pct}%</span>
                <p class="font-poppins text-xs text-gray-500">${label}</p>
              </div>
            </div>
            <div class="progress-track">
              <div class="progress-fill" style="width: ${pct}%; --pct: ${pct}%"></div>
            </div>
          </div>
        `;
      }).join("");
    }

    async function loadDashboardStatus() {
      const list = document.getElementById("dashStatusList");
      list.innerHTML = `<div class="flex justify-center py-10"><div class="spinner"></div></div>`;
      const items = await fetchStatus();
      if (!items.length) {
        list.innerHTML = `<p class="text-center text-gray-600 py-10 font-poppins text-sm">No status items.</p>`;
        return;
      }
      list.innerHTML = items.map(item => {
        const pct = item.progress || 10;
        return `
          <div class="glass-card rounded-xl p-4 flex items-center gap-4">
            <div class="flex-1 min-w-0">
              <p class="font-bebas text-white text-lg tracking-wider truncate">${escHtml(item.clientName)}</p>
              <p class="font-poppins text-xs text-gray-500 truncate">${escHtml(item.projectTitle || "")}</p>
              <div class="progress-track mt-2 h-2">
                <div class="progress-fill" style="width: ${pct}%; --pct: ${pct}%"></div>
              </div>
            </div>
            <div class="flex-shrink-0 text-right">
              <span class="font-bebas text-xl text-purple-300">${pct}%</span>
            </div>
            <div class="flex gap-2 flex-shrink-0">
              <button onclick="editStatusItem('${item.id}','${escAttr(item.clientName)}','${escAttr(item.projectTitle||'')}','${pct}')"
                class="btn-icon text-blue-400 hover:text-blue-300"><i class="fa-solid fa-pen text-xs"></i></button>
              <button onclick="deleteStatusItem('${item.id}')"
                class="btn-icon text-red-400 hover:text-red-300"><i class="fa-solid fa-trash text-xs"></i></button>
            </div>
          </div>
        `;
      }).join("");
    }

    window.saveStatusItem = async () => {
      const editId  = document.getElementById("editStatusId").value;
      const client  = document.getElementById("sClient").value.trim();
      const project = document.getElementById("sProject").value.trim();
      const progress = parseInt(document.getElementById("sProgress").value);

      if (!client) { showToast("Client name is required.", "error"); return; }

      setBtnLoading("saveStatusBtn", true);
      try {
        if (editId) {
          await updateDoc(doc(db, "status", editId), { clientName: client, projectTitle: project, progress });
          showToast("Status updated!", "success");
        } else {
          await addDoc(collection(db, "status"), { clientName: client, projectTitle: project, progress, createdAt: serverTimestamp() });
          showToast("Status added!", "success");
        }
        clearStatusForm();
        loadDashboardStatus();
        loadPublicStatus();
      } catch (e) {
        showToast("Error: " + e.message, "error");
      }
      setBtnLoading("saveStatusBtn", false);
    };

    window.editStatusItem = (id, client, project, progress) => {
      document.getElementById("editStatusId").value = id;
      document.getElementById("sClient").value = client;
      document.getElementById("sProject").value = project;
      document.getElementById("sProgress").value = progress;
      document.getElementById("saveStatusBtn").innerHTML = '<i class="fa-solid fa-floppy-disk mr-2"></i>Update Status';
      document.getElementById("cancelEditStatus").classList.remove("hidden");
      document.getElementById("statusForm").scrollIntoView({ behavior: "smooth" });
    };

    window.cancelStatusEdit = () => { clearStatusForm(); };

    function clearStatusForm() {
      document.getElementById("editStatusId").value = "";
      document.getElementById("sClient").value = "";
      document.getElementById("sProject").value = "";
      document.getElementById("sProgress").value = "50";
      document.getElementById("saveStatusBtn").innerHTML = '<i class="fa-solid fa-plus mr-2"></i>Add Status';
      document.getElementById("cancelEditStatus").classList.add("hidden");
    }

    window.deleteStatusItem = async (id) => {
      if (!confirm("Delete this status?")) return;
      try {
        await deleteDoc(doc(db, "status", id));
        showToast("Deleted.", "success");
        loadDashboardStatus();
        loadPublicStatus();
      } catch (e) { showToast("Error: " + e.message, "error"); }
    };

    // ─── LIGHTBOX ────────────────────────────────────────────────────────────
    window.openLightbox = (src, title, desc) => {
      document.getElementById("lbImg").src = src;
      document.getElementById("lbTitle").textContent = title;
      document.getElementById("lbDesc").textContent = desc;
      document.getElementById("lightbox").classList.remove("hidden");
      document.getElementById("lightbox").classList.add("flex");
      document.body.style.overflow = "hidden";
    };
    window.closeLightbox = () => {
      document.getElementById("lightbox").classList.add("hidden");
      document.getElementById("lightbox").classList.remove("flex");
      document.body.style.overflow = "";
    };

    // ─── HELPERS ─────────────────────────────────────────────────────────────
    function showToast(msg, type = "info") {
      const t = document.getElementById("toast");
      const colors = { success: "border-green-500 text-green-300", error: "border-red-500 text-red-300", info: "border-purple-500 text-purple-300" };
      t.className = `toast-base glass border ${colors[type]}`;
      t.querySelector("#toastMsg").textContent = msg;
      t.classList.remove("toast-hidden");
      t.classList.add("toast-show");
      clearTimeout(window._toastTimer);
      window._toastTimer = setTimeout(() => {
        t.classList.remove("toast-show");
        t.classList.add("toast-hidden");
      }, 3500);
    }

    function setBtnLoading(btnId, loading) {
      const btn = document.getElementById(btnId);
      btn.disabled = loading;
      btn.style.opacity = loading ? "0.6" : "1";
    }

    function escHtml(str) { return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }
    function escAttr(str) { return String(str).replace(/'/g,"&#39;").replace(/"/g,"&quot;"); }

    // ─── INIT ────────────────────────────────────────────────────────────────
    document.addEventListener("DOMContentLoaded", () => {
      showView("public");
    });
  </script>

  <style>
    :root {
      --neon: #bf00ff;
      --glow: #d966ff;
      --mid: #7b00cc;
      --bg: #060609;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      background-color: var(--bg);
      font-family: 'Poppins', sans-serif;
      color: #e0d8f0;
      overflow-x: hidden;
    }

    /* Ambient background */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0;
      background:
        radial-gradient(ellipse 80% 50% at 15% 5%, rgba(123,0,204,0.15) 0%, transparent 55%),
        radial-gradient(ellipse 60% 40% at 85% 90%, rgba(191,0,255,0.1) 0%, transparent 50%);
      pointer-events: none;
    }

    body::after {
      content: '';
      position: fixed; inset: 0; z-index: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
      pointer-events: none; opacity: 0.5;
    }

    /* Font aliases */
    .font-bebas { font-family: 'Bebas Neue', sans-serif; }
    .font-poppins { font-family: 'Poppins', sans-serif; }
    .font-mono { font-family: 'DM Mono', monospace; }

    /* Glass morphism */
    .glass {
      background: rgba(255,255,255,0.04);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-b
